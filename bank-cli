#!/usr/bin/env bash
# bank-cli - Convenient wrapper for Bank CLI application
#
# Usage:
#   ./bank-cli                 Run the application
#   ./bank-cli --help          Show application help
#
# For developers:
#   make run                   Build and run
#   make dev                   Verify, build, and run

set -e

# Locate the DLL relative to script location
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DLL="$SCRIPT_DIR/.build/bin/Debug/net9.0/bank-cli.dll"

# Check if DLL exists
if [ ! -f "$DLL" ]; then
    echo "Error: Build output not found at $DLL" >&2
    echo "" >&2
    echo "Please build the project first:" >&2
    echo "  make build" >&2
    echo "" >&2
    echo "Or for full workflow:" >&2
    echo "  make dev    # Verify + build + run" >&2
    exit 1
fi

# Check if dotnet is available
if ! command -v dotnet &> /dev/null; then
    echo "Error: dotnet command not found" >&2
    echo "" >&2
    echo "Please install .NET SDK:" >&2
    echo "  brew install dotnet" >&2
    echo "" >&2
    echo "Or for a specific version:" >&2
    echo "  brew install dotnet@9" >&2
    exit 1
fi

# Set DOTNET_ROOT if not already set (helps find runtime on macOS)
if [ -z "$DOTNET_ROOT" ]; then
    if [ -d "/opt/homebrew/opt/dotnet/libexec" ]; then
        export DOTNET_ROOT="/opt/homebrew/opt/dotnet/libexec"
    fi
fi

# Execute the DLL with dotnet (supports .NET >= 9.0 via RollForward)
exec dotnet "$DLL" "$@"
