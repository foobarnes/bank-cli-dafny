#!/usr/bin/env bash
# bank-cli - Convenient wrapper for Bank CLI application
#
# Usage:
#   ./bank-cli                 Run the application
#   ./bank-cli --help          Show application help
#
# For developers:
#   make run                   Build and run
#   make dev                   Verify, build, and run

set -e

# Locate the DLL relative to script location
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DLL="$SCRIPT_DIR/.build/bin/Debug/net8.0/bank-cli.dll"

# Check if DLL exists
if [ ! -f "$DLL" ]; then
    echo "Error: Build output not found at $DLL" >&2
    echo "" >&2
    echo "Please build the project first:" >&2
    echo "  make build" >&2
    echo "" >&2
    echo "Or for full workflow:" >&2
    echo "  make dev    # Verify + build + run" >&2
    exit 1
fi

# Check if dotnet is available
if ! command -v dotnet &> /dev/null; then
    echo "Error: dotnet command not found" >&2
    echo "" >&2
    echo "Please install .NET SDK:" >&2
    echo "  brew install dotnet@8" >&2
    echo "" >&2
    echo "And add to your PATH:" >&2
    echo "  export PATH=\"/opt/homebrew/opt/dotnet@8/bin:\$PATH\"" >&2
    exit 1
fi

# Execute the DLL with dotnet (supports .NET >= 8.0 via RollForward)
exec dotnet "$DLL" "$@"
